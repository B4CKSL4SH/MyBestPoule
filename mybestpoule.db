SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='';

DROP SCHEMA IF EXISTS mybestpoule;
CREATE SCHEMA IF NOT EXISTS `mybestpoule` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ;
USE `mybestpoule` ;

create table user (
	id integer AUTO_INCREMENT,
	name text,
	type smallint,
	primary key (id)
) ENGINE=InnoDB;

create table group_type (
	id integer AUTO_INCREMENT,
	label text,
	image text,
	primary key (id)
) ENGINE=InnoDB;

create table group_details (
	id integer AUTO_INCREMENT,
	group_type_id integer,
	title text,
	created_at datetime default now(),
	updated_at datetime default null,
	event_at datetime,
	price float(7,2),
	localization text default null,
	coords text default null,
	description text default null,
	is_valid tinyint(1) default 0,
	INDEX `fk_groupdetails_grouptypeid_idx` (`group_type_id` ASC),
	primary key (id),
	CONSTRAINT `fk_groupdetails_grouptypeid`
	    FOREIGN KEY (`group_type_id`)
	    REFERENCES `mybestpoule`.`group_type` (`id`)
	    ON DELETE NO ACTION
	    ON UPDATE NO ACTION
) ENGINE=InnoDB;

create table user_group_list (
	id integer AUTO_INCREMENT,
	user_id integer,
	group_details_id integer,
	INDEX `fk_usergrouplist_userid_idx` (`user_id` ASC),
	INDEX `fk_usergrouplist_groupdetailsid_idx` (`group_details_id` ASC),
	primary key (id),
	CONSTRAINT `fk_usergrouplist_userid`
	    FOREIGN KEY (`user_id`)
	    REFERENCES `mybestpoule`.`user` (`id`)
	    ON DELETE NO ACTION
	    ON UPDATE NO ACTION,
	CONSTRAINT `fk_usergrouplist_groupdetailsid`
	    FOREIGN KEY (`group_details_id`)
	    REFERENCES `mybestpoule`.`group_details` (`id`)
	    ON DELETE NO ACTION
	    ON UPDATE NO ACTION
) ENGINE=InnoDB;

insert into group_type (label) values ('Cours'), ('Coaching'), ('Actions groupées');
insert into group_details (is_valid, group_type_id, title, event_at, price, coords) values (
	1, 1, 'Cours de Math', '2017-09-22 18:00:00', 12.09, '{"lat": "48.8620722", "lon": "2.352047"}'
), (0, 1, 'Cours de Fr', '2017-09-30 21:00:00', 32.45, '{"lat": "48.88247672", "lon": "2.35566598"}'
), (0, 1, 'Cours d''Anglais', '2017-10-02 17:00:00', 42.03, '{"lat": "48.85592868", "lon": "2.36074691"}'
), (1, 2, 'Coaching Séduction', '2017-09-19 13:00:00', 21.87, '{"lat": "48.85374426", "lon": "2.30413425"}'
), (0, 3, 'Actions groupées "Fuite d''eau co-propriété Les Ulysses"', '2017-09-16 19:00:00', 65.90, '{"lat": "48.86920446", "lon": "2.36250864"}'
);

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;